<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>FTTH - Blink Top 3 Points</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
  html, body {
    height: 100%;
    margin: 0;
  }
  #map {
    width: 100%;
    height: 100%;
  }

  /* ===== HIỆU ỨNG NHẤP NHÁY VIỀN ===== */
  .blink-ring {
    animation: blinkStroke 1s infinite ease-in-out;
  }

  @keyframes blinkStroke {
    0% {
      opacity: 1;
      stroke-width: 4;
    }
    50% {
      opacity: 0.2;
      stroke-width: 1.5;
    }
    100% {
      opacity: 1;
      stroke-width: 4;
    }
  }
</style>
</head>

<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* ================= MAP ================= */
const map = L.map('map').setView([10.762622, 106.660172], 14);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

/* ================= DATA ================= */
const customer = [10.762622, 106.660172];

const points = [
  { name: 'Tập điểm A', lat: 10.766, lng: 106.655, score: 95 },
  { name: 'Tập điểm B', lat: 10.758, lng: 106.662, score: 92 },
  { name: 'Tập điểm C', lat: 10.764, lng: 106.668, score: 90 },
  { name: 'Tập điểm D', lat: 10.770, lng: 106.670, score: 80 }
];

/* ================= CUSTOMER ================= */
L.circleMarker(customer, {
  radius: 7,
  color: '#000',
  fillColor: '#ff0000',
  fillOpacity: 1
}).addTo(map).bindPopup('Khách hàng');

/* ================= SORT TOP 3 ================= */
const top3 = points
  .sort((a, b) => b.score - a.score)
  .slice(0, 3);

/* ================= DRAW ================= */
points.forEach(p => {
  const isTop3 = top3.includes(p);

  /* ---- VÒNG TRÒN CHÍNH ---- */
  L.circleMarker([p.lat, p.lng], {
    radius: 6,
    color: '#0066ff',
    weight: 2,
    fillColor: '#0066ff',
    fillOpacity: 0.8
  })
  .addTo(map)
  .bindPopup(`${p.name}<br>Score: ${p.score}`);

  /* ---- VIỀN NHẤP NHÁY (CHỈ TOP 3) ---- */
  if (isTop3) {
    L.circleMarker([p.lat, p.lng], {
      radius: 9,
      color: '#0066ff',
      weight: 4,
      fill: false,
      opacity: 1,
      className: 'blink-ring'
    }).addTo(map);

    /* ---- ĐƯỜNG NỐI ---- */
    L.polyline([customer, [p.lat, p.lng]], {
      color: '#ff6600',
      dashArray: '6,4',
      weight: 2
    }).addTo(map);
  }
});
</script>
</body>
</html>
